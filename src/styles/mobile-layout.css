/**
 * Mobile Layout Optimizations for Tasern Siegefront
 *
 * Phase 1: Critical layout fixes for mobile devices
 * Removes fixed width constraints and optimizes component stacking
 */

/* ==================== PHASE 1: LAYOUT RESTRUCTURING ==================== */

/* Remove fixed width constraints on mobile */
@media (max-width: 899px) {
  /* BattleView: Single column layout with optimized order */
  .battle-main-content {
    flex-direction: column;
    align-items: stretch;
    width: 100%;
    max-width: 100vw;
    gap: 1.5rem; /* Increased gap between sections */
    overflow-x: hidden !important; /* Never allow horizontal scroll */
    box-sizing: border-box;
  }

  /* Side panels: Remove fixed widths, use full width */
  .battle-side-panel {
    width: 100%;
    max-width: 100%;
    min-width: unset;
    flex: 1 1 auto;
    order: 2; /* Will be overridden by specific classes */
    display: flex;
    flex-direction: column;
    gap: 1rem; /* Spacing between child elements */
    overflow-x: hidden; /* Prevent horizontal overflow */
    box-sizing: border-box;
  }

  /* Battlefield goes first */
  .battle-center-panel {
    order: 1;
    width: 100%;
    max-width: 100vw;
    margin-bottom: 1rem; /* Extra space after battlefield */
    overflow-x: hidden; /* Prevent horizontal overflow */
    box-sizing: border-box;
  }

  /* Player status sections: Clear spacing and overflow protection */
  .player-status-container {
    margin-bottom: 1rem;
    max-width: 100%;
    overflow-x: hidden;
    box-sizing: border-box;
  }

  /* Hand section: Clear spacing and overflow protection */
  .battle-hand-section {
    margin-top: 1rem;
    margin-bottom: 1rem;
    max-width: 100%;
    overflow: hidden; /* Prevent overflow in all directions */
    box-sizing: border-box;
  }

  /* Controls section: Clear spacing (desktop only) */
  .battle-controls-section {
    margin-top: 1rem;
    max-width: 100%;
    box-sizing: border-box;
  }

  /* Prevent body overflow */
  body {
    overflow-x: hidden !important;
    max-width: 100vw;
  }

  /* Ensure root doesn't overflow */
  #root {
    max-width: 100vw;
    overflow-x: hidden !important;
  }

  /* Header: Stack elements vertically */
  .battle-header {
    flex-direction: column;
    align-items: stretch;
    text-align: center;
    padding: 1rem;
    gap: 0.75rem;
  }

  .battle-header-right {
    align-items: center;
    width: 100%;
  }
}

/* Very small screens: Further compression */
@media (max-width: 599px) {
  .battle-view-container {
    padding: 0.5rem;
    gap: 0.5rem;
    max-height: 100vh;
    height: 100vh; /* Fixed height to prevent overflow */
    overflow-x: hidden !important; /* Never allow horizontal scroll */
    overflow-y: auto; /* Allow vertical scrolling if needed */
    -webkit-overflow-scrolling: touch;
    position: relative; /* Establish stacking context */
  }

  .battle-main-content {
    gap: 1rem; /* Maintain spacing even on small screens */
    max-width: 100vw; /* Prevent horizontal overflow */
    overflow-x: hidden !important;
  }

  .battle-header {
    padding: 0.75rem;
    gap: 0.5rem;
    max-width: 100vw; /* Prevent overflow */
  }

  .battle-side-panel {
    gap: 0.75rem;
    max-width: 100vw; /* Prevent overflow */
    overflow-x: hidden; /* Prevent horizontal scroll */
  }

  .battle-hand-section {
    margin-top: 0.75rem;
    margin-bottom: 0.75rem;
    max-width: 100vw; /* Prevent overflow */
    overflow-x: hidden; /* Parent container manages overflow */
  }

  /* Ensure center panel doesn't overflow */
  .battle-center-panel {
    max-width: 100vw;
    overflow-x: hidden;
  }
}

/* ==================== COMPONENT RESPONSIVE OVERRIDES ==================== */

/* PlayerStatus: Full width on mobile, no fixed minWidth */
@media (max-width: 899px) {
  .player-status-container {
    width: 100%;
    min-width: unset !important;
    max-width: 100%;
  }

  /* Compact mode: Reduce padding */
  .player-status-container {
    padding: 1rem;
  }
}

@media (max-width: 599px) {
  .player-status-container {
    padding: 0.75rem;
  }
}

/* BattleControls: Full width on mobile, no fixed minWidth */
@media (max-width: 899px) {
  .battle-controls-container {
    width: 100%;
    min-width: unset !important;
    max-width: 100%;
  }
}

/* Victory Card: Full width on mobile */
@media (max-width: 899px) {
  .victory-card {
    min-width: unset !important;
    width: 90vw;
    max-width: 500px;
    padding: 2rem;
  }
}

@media (max-width: 599px) {
  .victory-card {
    width: 100vw;
    max-width: 100vw;
    border-radius: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 1.5rem;
  }
}

/* ==================== BATTLEFIELD GRID MOBILE OPTIMIZATION ==================== */

@media (max-width: 899px) {
  .battlefield-grid {
    padding: 0.5rem;
    gap: 0.5rem;
    width: 100%;
    max-width: 100vw;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* Fixed smaller cell sizes instead of viewport units */
  .battlefield-cell {
    width: 100px !important;
    height: 140px !important;
    min-height: 140px;
    min-width: 100px;
  }

  /* Zone labels: Smaller and more compact */
  .zone-label {
    font-size: 10px;
    padding: 2px 4px;
    opacity: 0.7;
  }

  /* Formation legend: Collapsible on mobile */
  .formation-legend {
    max-height: 200px;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .formation-legend.collapsed {
    max-height: 40px;
  }

  .formation-legend-toggle {
    display: block;
    width: 100%;
    padding: 0.5rem;
    background: rgba(139, 105, 20, 0.3);
    border: 1px solid #8B6914;
    border-radius: 4px;
    color: #D4AF37;
    cursor: pointer;
    font-size: 14px;
    margin-bottom: 0.5rem;
  }
}

@media (max-width: 599px) {
  .battlefield-grid {
    padding: 0.25rem;
  }

  /* Even smaller cells for very small screens */
  .battlefield-cell {
    width: 90px !important;
    height: 130px !important;
    min-height: 130px;
    min-width: 90px;
  }

  /* Hide zone labels on very small screens */
  .zone-labels {
    display: none;
  }

  /* Weather display: Compact version */
  .weather-display {
    padding: 0.5rem;
    font-size: 12px;
    gap: 0.5rem;
  }

  .weather-icon {
    font-size: 1.2rem !important;
  }

  .weather-name {
    font-size: 14px !important;
  }

  .weather-duration {
    font-size: 11px !important;
  }
}

/* ==================== HAND DISPLAY MOBILE CAROUSEL ==================== */

@media (max-width: 899px) {
  /* Container wrapping - prevent overflow */
  .battle-hand-section {
    width: 100%;
    overflow: hidden; /* Prevent overflow from parent */
  }

  /* Switch to horizontal scroll carousel */
  .hand-display-container,
  .hand-cards-container {
    display: flex;
    flex-direction: row !important;
    overflow-x: auto;
    overflow-y: hidden;
    scroll-snap-type: x mandatory;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    gap: 0.75rem;
    padding: 0.75rem;
    padding-bottom: 1rem; /* Extra padding at bottom */
    max-height: unset !important;
    max-width: 100vw; /* Prevent horizontal overflow */
  }

  .hand-display-container::-webkit-scrollbar,
  .hand-cards-container::-webkit-scrollbar {
    display: none;
  }

  .hand-card-wrapper {
    scroll-snap-align: center;
    flex-shrink: 0;
    width: 160px;
    min-width: 160px;
    max-width: 160px;
  }

  /* Show 1.5 cards to hint more exist */
  .hand-cards-container {
    padding-right: 40vw;
  }
}

@media (max-width: 599px) {
  .hand-card-wrapper {
    width: 140px;
    min-width: 140px;
    max-width: 140px;
  }

  .hand-cards-container {
    padding: 0.5rem;
    gap: 0.5rem;
  }
}

/* ==================== CARD DISPLAY MOBILE SCALING ==================== */

@media (max-width: 899px) {
  .card-display {
    width: 160px !important;
    padding: 0.75rem;
  }

  /* Scale internal elements */
  .card-display .name {
    font-size: 14px;
  }

  .card-display .manaCost {
    font-size: 16px;
  }

  .card-display .artContainer {
    height: 100px;
  }

  .card-display .stat {
    gap: 1px;
  }

  .card-display .statIcon {
    font-size: 14px;
  }

  .card-display .statValue {
    font-size: 14px;
  }
}

@media (max-width: 599px) {
  .card-display {
    width: 140px !important;
    padding: 0.5rem;
  }

  .card-display .name {
    font-size: 12px;
  }

  .card-display .manaCost {
    font-size: 14px;
  }

  .card-display .artContainer {
    height: 80px;
  }

  .card-display .statIcon {
    font-size: 12px;
  }

  .card-display .statValue {
    font-size: 13px;
    font-weight: 700;
  }

  .card-display .hpLabel {
    font-size: 11px;
  }

  .card-display .ability {
    font-size: 10px;
    padding: 1px 3px;
  }
}

/* ==================== LANDSCAPE MOBILE OPTIMIZATIONS ==================== */

@media (max-width: 899px) and (orientation: landscape) {
  .battle-view-container {
    padding: 0.5rem;
  }

  .battle-header {
    padding: 0.5rem 1rem;
  }

  /* Compact header in landscape */
  .battle-header h1 {
    font-size: 1.5rem;
  }

  /* Two-column layout for landscape */
  .battle-main-content {
    flex-direction: row;
    gap: 0.75rem;
  }

  .battle-center-panel {
    flex: 1;
    order: 1;
  }

  .battle-side-panel {
    flex: 0 0 280px;
    max-width: 280px;
    order: 2;
  }

  /* Smaller cards in landscape */
  .card-display {
    transform: scale(0.85);
    transform-origin: center;
  }

  /* Smaller battlefield cells */
  .battlefield-cell {
    width: 85px !important;
    height: 120px !important;
  }
}

/* ==================== MENU/LOBBY MOBILE OPTIMIZATION ==================== */

@media (max-width: 899px) {
  .menu-container {
    padding: 1rem;
    min-height: 100vh;
  }

  .menu-card {
    width: 100%;
    max-width: 100%;
    padding: 2rem 1.5rem;
  }

  /* Grid selection: Horizontal scroll */
  .grid-button-container,
  .map-button-container {
    display: flex;
    flex-direction: row;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    gap: 1rem;
    padding: 1rem 0.5rem;
    -webkit-overflow-scrolling: touch;
  }

  .grid-button,
  .map-button {
    flex-shrink: 0;
    scroll-snap-align: center;
    min-width: 250px;
    max-width: 250px;
  }

  /* Opponent buttons: Full width */
  .opponent-button {
    width: 100%;
    padding: 1.25rem;
  }
}

@media (max-width: 599px) {
  .menu-container {
    padding: 0.5rem;
  }

  .menu-card {
    padding: 1.5rem 1rem;
    border-radius: 8px;
  }

  .grid-button,
  .map-button {
    min-width: 200px;
    max-width: 200px;
  }

  .opponent-button {
    padding: 1rem;
  }
}

/* ==================== STICKY CONTROLS ON MOBILE ==================== */

@media (max-width: 899px) {
  /* Sticky "End Turn" button at bottom */
  .mobile-sticky-controls {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(26, 20, 16, 0.98) 80%, rgba(26, 20, 16, 0.95) 100%);
    padding: 1rem;
    padding-bottom: max(1rem, env(safe-area-inset-bottom));
    z-index: 100;
    display: flex;
    gap: 0.75rem;
    justify-content: center;
    align-items: center;
    box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.7);
    border-top: 2px solid rgba(212, 175, 55, 0.3);
  }

  .mobile-sticky-controls button {
    flex: 1;
    max-width: 200px;
    min-height: 56px;
    font-size: 18px;
    font-weight: 700;
  }

  /* Add padding to bottom of content to prevent overlap */
  .battle-view-container.has-sticky-controls {
    padding-bottom: calc(100px + env(safe-area-inset-bottom));
    max-height: 100vh;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* Ensure main content doesn't go under sticky controls */
  .battle-main-content {
    padding-bottom: 1rem; /* Extra padding for breathing room */
  }
}

/* ==================== UTILITIES ==================== */

/* Hide on mobile */
@media (max-width: 899px) {
  .hide-mobile {
    display: none !important;
  }

  .show-mobile {
    display: inherit !important; /* Inherit original display type */
  }
}

/* Show on mobile, hide on desktop */
@media (min-width: 900px) {
  .hide-desktop {
    display: none !important;
  }

  .show-mobile {
    display: none !important;
  }

  .hide-mobile {
    display: inherit !important; /* Show on desktop with original display type */
  }
}

/* Prevent scroll when interacting */
.no-scroll {
  overflow: hidden;
  touch-action: none;
}

/* Enhanced touch feedback */
@media (max-width: 899px) {
  .touch-feedback:active {
    transform: scale(0.97);
    transition: transform 0.1s ease;
  }

  .card-display:active {
    transform: scale(0.95);
  }
}
